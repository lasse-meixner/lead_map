---
title: "Lead exposure risk in Leeds"
author: "Lead Map Project Team"
format: 
  revealjs:
    css: styles.css
    toc: true
    toc-depth: 1
    slideNumber: true
    auto: true
execute:
  echo: true
  cache: true
jupyter: lead_map
---

## Testing kids in Leeds for lead
- We collected a lot of **demographic**, **socioeconomic**, and **environmental** data the MSOA level for England.

- Using this data, we want to identify high-risk areas for lead exposure for children in Leeds.
  - What do we know about kids in Leeds?
  - What do we know about risk factors in Leeds?

# Data Overview
## Introduction to MSOAs
- Middle Layer Super Output Areas are geographic units within local authority districts used for detailed data reporting.
- Each MSOA includes 2,000–6,000 households or 5,000–15,000 people.
- MSOA analysis allows for detailed exploration at a granular level, rather than viewing Leeds as a single unit.
- Leeds contains a total of 107 MSOAs

<!-- todo: OA level? -->

## UK MSOA data
We collect socioeconomic, demographic, and environmental data at the MSOA level from the following sources:

-	UK 2011 Census
-	UK ONS Poverty Rate Estimates
-	UK Index of Multiple Deprivation Data 2015
-	UK Stock of Properties Data
-	England Moss Pollution Data
-	England Soil Pollution Data

We believe that a combination of them can give a good indication of lead exposure risk for children in the UK, including Leeds.

## Where are the kids in Leeds?

```{python}
#| label: imports
#| echo: false
#| cache: false

from plotting_functions import *

import sys
sys.path.append('../UK/predictors/exploration')
from shapefile_loading import get_msoa_merged_shapefile
```

```{python}
#| label: load-data
#| echo: false

merged, cols = get_msoa_merged_shapefile(path_relative_to_UK="../UK/predictors")
```

```{python}
#| label: kids-location
#| echo: false

fig = plot_chloropleth("total_kids_2011", merged, "Leeds")
fig.update_layout(title_text="Distribution of kids in Leeds")
fig.show()
```

## Location of children under 5 years

```{python}
#| label: kids-u5-location
#| echo: false

fig = plot_chloropleth("total_ppl_u5_totalpop_prop_2011", merged, "Leeds")
fig.show()
```


- If we look at the distribution of kids under 5 years, the distribution is similar to the overall distribution of kids
  

## Location of families by age of parents

```{python}
#| label: correlation income & house prices
#| echo: false

fig = plot_pairs(["house_price_mean_median_2017to2021", "frp_u24_fam_w_kids_prop_2011","frp_50_64_fam_w_kids_prop_2011"], merged, "Leeds")
fig.show()
```

- Young parents tend to live in the center of Leeds, while older parents live in the wealthier outskirts

<!-- does the census variable count kids, or kids in household -->

# Risk factors: Housing

## Why housing

- Lead paint was widely used in the UK before 1963. A 1963 agreement required labelling on paint cans with >1% lead, warning people against its use in areas accessible to children.
- White lead paint was not banned until 1992, so housing built before 1992 still pose lead risks.

## Housing age variables

We use the UK Stock of properties data to obtain the proportion of houses built in various intervals. We focus on the following variables:
- Proportion of Houses Built 1930-1939
- Proportion of Houses Built 1945-1954
- Proportion of Houses Built 1955-1964

- Proportion of houses built before 1992
- Proportion of houses built before 1972
- Proportion of houses built before 1954

<!-- put entire list of variables -->

## Proportion of houses built before 1992

```{python}
#| label: housing-pre-1992-location
#| echo: false

fig = plot_chloropleth("bp_pre_1992_prop", merged, "Leeds")
fig.show()
```

- These were built before a legal ban on lead paint

## Proportion of houses built before 1954

<!-- Note: perhaps think about different color scale -->

```{python}
#| label: housing-pre-1954-location
#| echo: false

fig = plot_chloropleth("bp_pre_1954_prop", merged, "Leeds")
fig.show()
```

- These are likely to have at least some lead paint

## Proportion of houses built before 1939

```{python}
#| label: housing-pre-1939-location
#| echo: false

fig = plot_chloropleth("bp_pre_1939_prop", merged, "Leeds")
fig.show()
```

- These are almost guaranteed to have lead paint

## Distribution of (median) house prices

```{python}
#| label: house-prices-location
#| echo: false

fig = plot_chloropleth("house_price_mean_median_2017to2021", merged, "Leeds")
fig.update_layout(title_text="Distribution of house prices in Leeds")
fig.show()
```

- House prices are highest in the north
- Median house prices 2017-2021 have tripled since 1995-2000

# Risk factors: Employment

## Primary and secondary sector employment

Primary and secondary sector employment often mean working near industrial sites which use lead as a raw material as part of the production process. (Note: maybe lead roofings for construction. but we dont know much about the construction attribution so I'd maybe leave this out too)

We use the UK 2011 Census to investigate the following jobs and its impact on lead exposure:
- Proportion Working in Mining (Note: proportions are miniscule, I'd leave this out)
- Proportion Working in Construction 
- Proportion Working in Machinery and Plants


## Unemployment and economic inactivity 

- Higher rates of unemployment and economic inactivity are often found in lower-income areas
- Residents may have fewer housing options and are likelier to live in older, potentially lead-contaminated buildings.

We have the following variables from the UK 2011 census:

- Proportion of unemployed (by gender)
- Proportion of economically inactive (by gender)
# Risk factors: Deprivation

## Why Deprivation

- The IMD combines income explores income, employment, educational skills, health, housing, crime and living environment conditions to form a measure of area-level deprivation in the UK.
- Aizer (2017), Brulle & Pellow (2006), Bullard (1994) find that more deprived families face greater lead exposure risks, with fewer resources for renovations or relocation.
- Childhood lead exposure is linked to criminal behaviour and aggression.

## Index of Multiple Deprivation Data

By using the UK Index of Multiple Deprivation 2015 data, we capture factors linked to lead exposures providing a basis for predicting high-risk areas.

The variables used are:

- Overall IMD Deprivation Score
- IMD Income Score
- IMD Health Disability Score
- IMD Housing Services Score

# Risk factors: Single parenting

## Single Parent Incidence

- Single parents rely on a single income and this limits access to safer housing, often resulting in older homes with potential for lead paint.

- Single parents may have less time to monitor lead hazards at home 

- We focus on the **proportion of single parent families** from the UK 2011 census

## Location of single parents families

```{python}
#| label: single-parents-location
#| echo: false

fig = plot_chloropleth("lone_parent_fam_w_kids_prop_2011", merged, "Leeds")
fig.show()
```

# Risk factors: Income and poverty

## Location of high incomes

- The outskirts are richer than the center, especially the north
- Except for the old town, the center is poorer
```{python}
#| label: high-income-location
#| echo: false

fig = plot_chloropleth("median_annual_incomeE", merged, "Leeds")
fig.update_layout(title="Median annual incomes (estimated)")
fig.show()
```

## Poverty rate

<!-- cdf plot is not very clear: show comparison of centralities -->

```{python}
#| label: poverty-comparison
#| echo: false

fig = plot_CDFs("poverty_rateE", merged, "Leeds")
fig.show()
```
- Poverty rates in Leeds have a heavier tail then the UK

## Location of poverty

<!-- todo: find out exact definition of poverty -->
```{python}
#| label: poverty-location
#| echo: false

fig = plot_chloropleth("poverty_rateE", merged, "Leeds")
fig.show()
```

- Poverty rates are highest towards the center

## Minority population

- (Wheeler et al. , 2021) find that African Americans face a higher risk of deprivation and lead poisoning in Maryland. 
- While the structural system in the US differs, as a comparatively poorer population it may well be an at-risk group in the UK.

From the UK 2011 Census we consider the following groups:
-	Proportion of Black People
-	Proportion of White People
- Proportion of Immigrants (todo: check in what form we have this!)

## Correlation of black population and poverty

```{python}
#| label: black-poverty-correlation
#| echo: false

fig = plot_pairs(["black_ppl_prop_2011", "poverty_rateE"], merged, "Leeds")
fig.show()
```

## Location of black population

```{python}
#| label: black-population-location
#| echo: false

fig = plot_chloropleth("black_ppl_prop_2011", merged, "Leeds")
fig.show()

```
- The population of black people is concentrated in the north of the center

# Risk factors: Education

## Parental educational attainment

- Parental education level directly impacts socioeconomic status, affecting housing options and access to resources

- Higher educational attainment may be linked to greater awareness of lead exposure risks, making parents likelier to avoid high risk environments.

Using the UK 2011 census we analyse:

- Proportion of parents with level 1 qualifications
- Proportion of parents with level 2 qualifications
- Proportion of parents with level 3 qualifications
- Proportion of parents with level 4 qualifications

## Location of educated parents

```{python}
#| label: education-location
#| echo: false

fig = plot_chloropleth("l4_qual_ppl_w_kids_prop_2011", merged, "Leeds")
fig.update_layout(title="Proportion of people with higher education in Leeds")
fig.show()
```

## Location of uneducated parents

```{python}
#| label: uneducated-location
#| echo: false

fig = plot_chloropleth("no_qual_ppl_w_kids_prop_2011", merged, "Leeds")
fig.update_layout(title="Proportion of people with lower education in Leeds")
fig.show()
```

- This correlates highly with the poverty map

## Correlation between education of parents and income

```{python}
#| label: education-income-correlation
#| echo: false

fig = plot_pairs(["l4_qual_ppl_w_kids_prop_2011","poverty_rateE","no_qual_ppl_w_kids_prop_2011"], merged, "Leeds")
fig.show()
```


# Risk factors: Pollution

# Pollution indicators
- Moss and soil absorb heavy metals that are in the atmosphere, and can therefore be used as a bioindicator for (past) lead presence. We have data both on:
  - Moss lead concentration (2005)
  - Soil lead concentration

- Since moss measurements are extremely sparse and MSOA-level values mostly imputed, we focus on soil lead concentration
<!-- add sources! -->

## Soil Lead

::: {.columns}
::: {.column width="50%"}
We obtain gridded topsoil lead concentration data from the UK Geological Survey[^1].
The data they publish is produced as follows:
- collected raw data point measures based on 5 surveys conducted until 2014.
- to produce a continous prediction map, they use an interpolation method (*ordinary kriging*)
- they fit an exponential variogram, using the nearest 5 to 8 neighbours within a maximum search radius of 10km
- based on this continous map, they produce a raster with 500m grid resolution
:::

::: {.column width="50%"}
<!-- add picture of UKGS -->
![](assets/Pb_v1.png)
:::
:::

We then use this grid to compute two measures:
- Mean soil lead concentration: Calculate the average lead concentration for all soil grid cells that intersect each MSOA.
- IDW mean soil lead concentration: Like the previous, but using an inverse distance weighting method to account for the distance between the grid cell and the MSOA centroid.

[^1]: UK Geological Survey. Retrieved from [https://www.ukso.org/static-maps/uk-topsoil-geochemistry.html](https://www.ukso.org/static-maps/uk-topsoil-geochemistry.html)

## Soil lead comparison
```{python}
#| label: soil-lead-comparison
#| echo: false
merged_no_soil_na = merged.dropna(subset=["soil_lead_mean"])
fig = plot_histograms("soil_lead_mean", merged_no_soil_na, location="Leeds", other_location="UK", n_bins=60)
fig.update_layout(title="Soil lead concentration in Leeds vs UK")
# limit x-axis to 300
fig.update_xaxes(range=[0, 300])
fig.show()
```

- compared to the overall UK distribution, Leeds has higher soil lead concentrations

## Soil lead location
```{python}
#| label: soil-lead
#| echo: false

fig = plot_chloropleth("soil_lead_mean", merged, "Leeds")
fig.show()
```

- High lead soil in Otley perhaps due to airport location?

# Hazard Map

## Idea

- We can combine the risk factors to create a hazard map
- We can use the hazard map to identify high risk areas
  
- This was previously done by Public Health England & Imperial College London, with our data we can supercede their work

## Comparison with Public Health England

We have more data, at a more granular level.
<!-- replace by columns -->

::: {.panel-tabset}

### Public Health England
- Level: LAD<br>
- Risk variables:<br>
  - % houses built pre 1973<br>
  - Index of Multiple Deprivation<br>
  - Soil lead concentration<br>
- Method:<br>
  - construct deciles for each risk factor<br>
  - compute decile risk by taking average of deciles<br>
  - recast risk back into deciles<br>

### Our approach
- Level: MSOA **(more granular)** <br>
- Risk variables: **(works dynamically for any selection)**<br>
  - % houses built pre 1954<br>
  - Index of Multiple Deprivation<br>
  - % of families with single parents<br>
  - House price median 2017-2021<br>
- Method: **(avoids loss of information from discretization)**<br>
  - transform each variable to a uniform distribution<br>
  - compute risk scores via average of values<br>
  - since risk variables are dependent, risk scores themselves will likely not be uniform -> re-transform to a uniform scale

:::

## Risk map

```{python}
#| label: risk-map
#| echo: false

risk_factors = ["bp_pre_1954_prop", "imd_overall_score_2015", "lone_parent_fam_w_kids_prop_2011", "house_price_mean_median_2017to2021"]

fig = plot_risk_score(risk_factors, merged, "Leeds")
fig.update_layout(title="Risk map for Leeds")
fig.show()
```

The MSOAs with the highest risk scores are located in the **north/north-eastern belt** around the center of Leeds.
---
title: "Lead exposure risk in Leeds"
author: "Lead Map Project Team"
format: 
  revealjs:
    css: styles.css
    toc: true
    toc-depth: 1
    slideNumber: true
    auto: true
execute:
  enabled: true
  echo: true
  cache: true
jupyter: lead_map
---

## Testing kids in Leeds for lead
- We collected a lot of **demographic**, **socioeconomic**, and **environmental** data the MSOA level for England.

- Using this data, we want to identify high-risk areas for lead exposure for children in Leeds.

  - What do we know about kids in Leeds?
  - What do we know about risk factors in Leeds?

# Data Overview
## Introduction to OAs
- Output Areas (OAs) are the smallest geographic units within local authority districts used for detailed data reporting.
- OA adjustments in the 2021 census include merging or splitting 2011 OAs to maintain these thresholds, except in cases like large prisons
- Around 200 OA boundaries were selectively realined to align with ward boundaries.
- Leeds contains a total of 2,543 OAs.

## Introduction to LSOAs
- Lower Layer Support Output Areas (LSOAs) are built from groups of OAs (typically four or five).
- Designed for consistent and comparable reporting of census data.
- Each LSOA contains 400-1,200 households and a resident population of 1,000 - 3,000 people.
- Leeds contains a total of 482 LSOAs.

## Introduction to MSOAs
- Middle Layer Super Output Areas are built from groups of four or five LSOAs.
- Each MSOA includes 2,000–6,000 households or 5,000–15,000 people.
- MSOA analysis allows for detailed exploration at a granular level, rather than viewing Leeds as a single unit.
- Leeds contains a total of 107 MSOAs.

## UK MSOA data
We collect socioeconomic, demographic, and environmental data at the MSOA level from the following sources:

-	UK 2011 Census
-	UK ONS Poverty Rate Estimates
-	UK Index of Multiple Deprivation Data 2015
-	UK Stock of Properties Data
-	England Moss Pollution Data
-	England Soil Pollution Data

We believe that a combination of them can give a good indication of lead exposure risk for children in the UK, including Leeds.

## Where are the kids in Leeds?

```{python}
#| label: imports
#| echo: false
#| cache: false

from plotting_functions import *
import sys
sys.path.append('../UK/predictors/exploration')
from shapefile_loading import get_msoa_merged_shapefile
```

```{python}
#| label: load-data
#| echo: false

merged, cols = get_msoa_merged_shapefile(path_relative_to_UK="../UK/predictors")
leeds = merged.loc[merged["msoa_name_x"].str.contains("Leeds")]
```

```{python}
#| label: kids-location
#| echo: false

fig = plot_chloropleth("total_kids_2011", merged, "Leeds")
fig.show()
```

## % of kids under 5

```{python}
#| label: kids-u5-location
#| echo: false

fig = plot_chloropleth("total_ppl_u5_totalpop_prop_2011", merged, "Leeds")
fig.show()
```


# Risk factors: Housing

## Why housing

- Lead paint was widely used in the UK before 1963. A 1963 agreement required labelling on paint cans with >1% lead, warning people against its use in areas accessible to children.
- White lead paint was not banned until 1992, so housing built before 1992 still pose lead risks.

## Housing age variables {.smaller .scrollable}

We use the UK Stock of properties data to obtain the proportion of houses built in various intervals. We focus on the following variables:

**Windows:**

- Proportion of Houses Built 1930-1939
- Proportion of Houses Built 1945-1954
- Proportion of Houses Built 1955-1964

**Cumulative:**

- Proportion of Houses built before 1939
- Proportion of houses built before 1954
- Proportion of houses built before 1972
- Proportion of houses built before 1983
- Proportion of houses built before 1992


## Proportion of houses built before 1992

```{python}
#| label: housing-pre-1992-location
#| echo: false

fig = plot_chloropleth("bp_pre_1992_prop", merged, "Leeds", color_continuous_scale="rdbu_r")
fig.show()
```

- These were built before a legal ban on lead paint

## Proportion of houses built before 1954


```{python}
#| label: housing-pre-1954-location
#| echo: false

fig = plot_chloropleth("bp_pre_1954_prop", merged, "Leeds", color_continuous_scale="rdbu_r")
fig.show()
```

- These are likely to have at least some lead paint

## Proportion of houses built before 1939

```{python}
#| label: housing-pre-1939-location
#| echo: false

fig = plot_chloropleth("bp_pre_1939_prop", merged, "Leeds", color_continuous_scale="rdbu_r")
fig.show()
```

- These are almost guaranteed to have lead paint

## House price data
- Median house price data is reported by the ONS which uses open data from HM Land Registry, a source of comprehensive record level administrative data on property transactions.
- This covers transactions within a four-quarter window (one year) and is updated each quarter
- The most granular level this is reported at is the LSOA level.

## Distribution of (median) house prices

```{python}
#| label: house-prices-location
#| echo: false

fig = plot_chloropleth("house_price_mean_median_2017to2021", merged, "Leeds", color_continuous_scale="Viridis")
fig.show()
```

- House prices are highest in the north
- Median house prices 2017-2021 have tripled since 1995-2000

# Risk factors: Employment

## Unemployment and economic inactivity 
- Unemployment rates are taken from the UK census by calculating the proportion of people who are unemployed by the number of economically active individuals aged 16 or over.
- Higher rates of unemployment and economic inactivity are often found in lower-income areas
- Residents may have fewer housing options and are likelier to live in older, potentially lead-contaminated buildings.

## Unemployment rate
<!-- todo: fix the bug where always house prices are shown...? -->
```{python}
#| label: unemployment-map
#| echo: false

plot_chloropleth("unemployed_16to74_ppl_prop_2011", merged, "Leeds", color_continuous_scale="rdbu_r")
fig.show()
```

# Risk factors: Deprivation

## Why Deprivation

- The IMD explores income, employment, educational skills, health, housing, crime and living environment conditions to form a measure of area-level deprivation in the UK.
- The IMD data is collected at the LSOA level.
- Aizer (2017), Brulle & Pellow (2006), Bullard (1994) find that more deprived families face greater lead exposure risks, with fewer resources for renovations or relocation.
- Childhood lead exposure is linked to criminal behaviour and aggression.

## Index of Multiple Deprivation Data

By using the UK Index of Multiple Deprivation 2015 data, we capture factors linked to lead exposures providing a basis for predicting high-risk areas.

The variables we use are:

- Overall IMD deprivation score
- IMD income score
- IMD health disability score
- IMD barriers to housing and services score

## Calculation of IMD Income Score {.smaller .scrollable}

- Out-of-work adults and children in families claiming specific benefits.
- Working individuals with low earnings satisfying means-tested criteria.

Key indicators include adults and children receiving:

1. Income Support
2. Income based job seeker's allowance
3. Income based employment and support allowance
4. Pension Credit 

This score is calculated by finding the total people satisfying these indicators as a proportion of the LSOA population.

## IMD health disability score
- Measures the risk of premature death and impairment of quality of life due to poor physical or mental health.
- Does not include behavior or environmental factors predictive of future health deprivation.

Indicators include:

1. Years of potential life lost
2. Comparative illness and disability ratio
3. Acute morbidity
4. Mood and anxiety disorders

## IMD health disability score [I]

1. **Years of potential life lost**: Age standardised measure of premature death. Based on 2013–2017 mortality data, weights unexpected deaths more heavily for younger individuals, using age-sex population estimates (excluding prisoners) to calculate impact.
2. **Comparative illness and disability ratio**: Age and sex-standardised morbidity/disability ratio based on those receiving benefits due to inability to work from ill health. This indicator is based on March 2016 data from the Department of Work and Pensions, compares actual versus expected benefit recipients. Uses age-sex standardised rate and excluding prisoners to adjust for population structure.

## IMD health disability score [II]

3. **Acute morbidity**: Measures the level of emergency admissions to hospital based on administrative records of in-patient admissions.

- This indicator is based on 2015/16–2016/17 emergency hospital admissions lasting over one day and uses age-sex standardised rates with 2016–2017 population estimates while excluding prisoners.

## IMD health disability score [III] {.scrollable}

4. **Mood and anxiety Disorders**: A composite measure derived from:
  - Prescribing data (from NHS Business Services Authority)
  - Hospital episode data (from Hospital Episode Statistics 2015/16-2016/17)
  - Suicide mortality data (from the ONS)

**Indicator weights for mood and anxiety disorders**

| **Indicator**                            | **Indicator Weight** |
|------------------------------------------|-----------------------|
| Prescribing data                         | 0.415                 |
| Hospital episode data                    | 0.381                 |
| Suicide mortality data                   | 0.205                 |


## Health disability score calculation

- The indicators within the domain were standardised by ranking and transforming to a normal distribution.
- Factor analysis was used to generate the weights to combine the indicators into the final domain score:

| **Indicator**                            | **Indicator Weight** |
|------------------------------------------|-----------------------|
| Years of potential life lost             | 0.271                 |
| Comparative illness and disability ratio | 0.300                 |
| Acute morbidity                          | 0.256                 |
| Mood and anxiety disorders               | 0.172                 |


## IMD barriers to housing and services score indicators
- Measures the physical and financial accessibility of housing and local services by considering geographical and wider barriers.
- Geographical indicators: mean road distance to the closest post office, primary school, supermarket or general store and GP surgery.
- Wider barrier indicator: LSOA proportion of household overcrowding,  homelessness measured by LAD rate of acceptances for housing assistance and housing affordability.

## IMD barriers to housing and services score calculation

- The indicators within each sub-domains are standardised by ranking
and transforming to a normal distribution.
- They are then combined using equal weights.
- The subdomains were then standardised by ranking and transforming to an exponential distribution and combined with equal weights to create the overall domain score. 

## Calculation of IMD overall score
The IMD overall score combines information from the seven domains to produce an overall relative measure of deprivation:

| **IMD Domain**                           | **Weight (%)** |
|-----------------------------------------|----------------|
| Income score                            | 22.5           |
| Employment deprivation                  | 22.5           |
| Education, skills and training          | 13.5           |
| Health deprivation and disability       | 13.5           |
| Crime                                   | 9.3            |
| Barriers to housing and services        | 9.3            |
| Living environment deprivation          | 9.3            |

# Risk factors: Income and poverty

## Income data
- Low-income households are more likely to live in older, poorly maintained housing with lead-based paint.
- Children in families with lower incomes have limited access to safer housing leading to longer exposure periods to lead.
- Our measure for income uses median household income data that is collected from the UK ONS at the MSOA level.

## Location of high incomes

- The outskirts are richer than the center, especially the north
- Except for the old town, the center is poorer
```{python}
#| label: high-income-location
#| echo: false

fig = plot_chloropleth("median_annual_incomeE", merged, "Leeds", color_continuous_scale="Viridis")
fig.show()
```

## Poverty rate data
- Poverty rate data is collected from the ONS and it reports the proportion of households living below 60% of median income.
- In order to have comparable poverty rates between different areas in the UK, we consider the poverty rate after adjusting for housing costs.
- This is reported at the MSOA level.

## Poverty rate

```{python}
#| label: poverty-comparison
#| cache: false
#| echo: false

# compute proportion of MSOAs that have more than 20% poverty.
leeds_poverty_cum_20 = round((leeds["poverty_rateE"] > 30).sum() / len(leeds),1)
uk_poverty_cum_20 = round((merged["poverty_rateE"] > 30).sum() / len(merged),1)

fig = plot_histograms("poverty_rateE", merged, "Leeds", n_bins=30)
fig.show()
```
- Poverty rates in Leeds have a heavier tail than the UK, with ``{python} leeds_poverty_cum_20`` of MSOAs having more than 20% poverty, compared to ``{python} uk_poverty_cum_20`` in the UK.

## Location of poverty

```{python}
#| label: poverty-location
#| echo: false

fig = plot_chloropleth("poverty_rateE", merged, "Leeds", color_continuous_scale="rdylbu")
fig.show()
```

- Poverty rates are highest towards the center

# Risk factors: Education

## Location of uneducated parents

```{python}
#| label: uneducated-location
#| echo: false

fig = plot_chloropleth("no_qual_ppl_w_kids_prop_2011", merged, "Leeds")
fig.show()
```


# Risk factors: Pollution

# Pollution indicators
- Moss and soil absorb heavy metals that are in the atmosphere, and can therefore be used as a bioindicator for (past) lead presence. We have data both on:
  - Moss lead concentration (2005)
  - Soil lead concentration

- Since moss measurements are extremely sparse and MSOA-level values mostly imputed, we focus on soil lead concentration.

## Soil Lead {.smaller .scrollable}

::: {.columns}
::: {.column width="50%"}
We obtain gridded topsoil lead concentration data from the UK Geological Survey[^1].
They

- collected raw data point measures based on 5 surveys conducted until 2014.
- to produce a continous prediction map, they use an interpolation method (*ordinary kriging*)
- they fit an exponential variogram, using the nearest 5 to 8 neighbours within a maximum search radius of 10km
- based on this continous map, they produce a raster with 500m grid resolution
:::

::: {.column width="50%"}
<!-- add picture of UKGS -->
![](assets/Pb_v1.png){width=80%}
:::
:::

We then use this 500m grid to compute two measures:
1. **Mean soil lead concentration**: 
   - Calculate the average lead concentration for all soil grid cells that intersect each MSOA.
2. **IDW mean soil lead concentration**: 
   - Like the previous, but using an inverse distance weighting method to account for the distance between the grid cell and the MSOA centroid.


[^1]: UK Geological Survey. Retrieved from [https://www.ukso.org/static-maps/uk-topsoil-geochemistry.html](https://www.ukso.org/static-maps/uk-topsoil-geochemistry.html)


## Soil lead comparison
```{python}
#| label: soil-lead-comparison
#| echo: false
merged_no_soil_na = merged.dropna(subset=["soil_lead_mean"])
fig = plot_histograms("soil_lead_mean", merged_no_soil_na, location="Leeds", other_location="UK", n_bins=40)
fig.update_layout(title="Soil lead concentration in Leeds vs UK")
# limit x-axis to 300
fig.update_xaxes(range=[0, 300])
fig.show()
```

- compared to the overall UK distribution, Leeds has higher soil lead concentrations

# Variable dependence

## Correlation between risk factors

```{python}
#| label: correlation
#| echo: false

risk_factors = ["bp_pre_1954_prop", "imd_overall_score_2015", "poverty_rateE", "house_price_mean_median_2017to2021", "soil_lead_mean"]
fig = plot_heatmap(risk_factors, merged, "Leeds")
fig.show()
```


# Hazard Map

## Idea

- We can combine the risk factors to create a hazard map
- We can use the hazard map to identify high risk areas
  
- This was previously done by Public Health England & Imperial College London, with our data we can supercede their work

## Comparison with Public Health England {.smaller .scrollable}

We have more data, at a more granular level.

| **Public Health England** | **Our approach** |
|---------------------------|------------------|
| **Level:** LAD            | **Level:** MSOA |
| **Risk variables:**       | **Risk variables:** |
| - % houses built pre 1973 | - % houses built pre 1954 |
| - Index of Multiple Deprivation | - Index of Multiple Deprivation |
| - Soil lead concentration | - Soil lead concentration |
|                          | - House price median 2017-2021 |
| **Method:**               | **Method:** **(avoids loss of information from discretization)** |
| - construct deciles for each risk factor | - transform each variable to a uniform distribution |
| - compute decile risk by taking average of deciles | - compute risk scores via average of values |
| - recast risk back into deciles | - since risk variables are dependent, risk scores themselves will likely not be uniform -> re-transform to a uniform scale |


## Risk map

```{python}
#| label: risk-map
#| echo: false

fig = plot_risk_score(risk_factors, merged, "Leeds")
fig.update_layout(title="Risk map for Leeds")
fig.show()
```

The MSOAs with the highest risk scores are located in the **north/north-eastern belt** around the center of Leeds.

## Risk comparison with ?Oxford

```{python}
#| label: risk-comparison
#| echo: false

merged_w_risk = compute_risk_score(merged, risk_factors)

# get leeds with UK-wide risk score
leeds_w_uk_based_risk = merged_w_risk.loc[merged_w_risk["msoa_name_x"].str.contains("Leeds")]
# compute population weighted average risk score of leeds
leeds_risk_score_mean = round((leeds_w_uk_based_risk["risk_score"] * leeds["total_kids_2011"]).sum() / leeds["total_kids_2011"].sum(), 1)

fig = plot_histograms("risk_score", merged_w_risk, "Leeds", other_location="Oxford", n_bins=10)
fig.update_layout(title="Risk score in Leeds vs Oxford")
fig.show()
```

- Overall in the UK, Leeds has a (kid-count weighted) average risk score of ``{python} leeds_risk_score_mean``.

